#!/usr/bin/env bash

set -euo pipefail

bindir=$( cd "${0%/*}" && pwd )
rootdir=$( cd "$bindir"/.. && pwd )
export INSTALLROOT="$rootdir/.linkerd2"
export LINKERD2_VERSION="${LINKERD2_VERSION:-edge-22.8.2}"
l5d="${INSTALLROOT}/bin/linkerd"
mkdir -p "$INSTALLROOT"

if [[ ! -x "$l5d" ]]; then
    curl --proto '=https' --tlsv1.2 -sSfL https://run.linkerd.io/install | sh
fi

"$l5d" "$@"

